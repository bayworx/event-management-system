<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>{% block title %}{{ company_config().name ?: 'Event Management System' }}{% endblock %}</title>
        <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 128 128%22><text y=%221.2em%22 font-size=%2296%22>ðŸ“…</text></svg>">
        
        <!-- Bootstrap CSS -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
        
        {% block stylesheets %}
        <style>
            .navbar-brand {
                font-weight: bold;
            }
            .footer {
                background-color: #f8f9fa;
                border-top: 1px solid #dee2e6;
            }
            .alert {
                border-radius: 0.375rem;
            }
            
            /* Fix dropdown positioning */
            .navbar-nav .dropdown-menu {
                position: absolute;
                z-index: 1050;
                transform: translate3d(0px, 0px, 0px) !important;
            }
            
            /* Ensure dropdowns are properly positioned */
            .dropdown {
                position: relative;
            }
            
            /* Fix any potential overflow issues */
            .navbar-collapse {
                position: static;
            }
            
            /* Force proper positioning for all Bootstrap dropdowns */
            .dropdown-menu {
                position: absolute !important;
                top: 100% !important;
                left: 0 !important;
                z-index: 1050 !important;
                transform: none !important;
            }
            
            /* Right-aligned dropdowns */
            .dropdown-menu-end {
                right: 0 !important;
                left: auto !important;
            }
            
            /* Add some spacing for the no-nav layout */
            body {
                padding-top: 0;
            }
            
            /* Make the main content area full height */
            main {
                min-height: calc(100vh - 120px);
            }
            
            /* Company logo header styling */
            .company-logo-header {
                transition: all 0.3s ease;
            }
            
            .company-logo-header:hover {
                background-color: #f8f9fa !important;
            }
            
            .company-logo {
                transition: transform 0.2s ease;
                filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
            }
            
            .company-logo-header a:hover .company-logo {
                transform: scale(1.05);
            }
            
            .company-logo-header a:hover .company-name {
                color: #495057 !important;
            }
            
            .company-name {
                font-size: 0.9rem;
                letter-spacing: 0.5px;
                color: #6c757d !important;
            }
            
            @media (max-width: 768px) {
                .company-logo {
                    max-height: 60px !important;
                }
                .company-name {
                    font-size: 0.8rem;
                }
            }
        </style>
        {% endblock %}
    </head>
    <body class="d-flex flex-column min-vh-100">
        <!-- Flash Messages (only displayed if present) -->
        {% for type, messages in app.flashes %}
            {% for message in messages %}
                <div class="alert alert-{{ type == 'error' ? 'danger' : (type == 'info' ? 'info' : type) }} alert-dismissible fade show" role="alert">
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            {% endfor %}
        {% endfor %}

        <!-- Main Content -->
        <main class="flex-grow-1">
            {% block body %}{% endblock %}
        </main>

        <!-- Footer -->
        <footer class="footer mt-auto py-3 border-top bg-light">
            <div class="container">
                {% set footer = footer_config() %}
                {% set company = company_config() %}
                
                {% set has_footer_content = footer.text or footer.link_1_text or footer.link_2_text or footer.link_3_text or footer.social_facebook or footer.social_twitter or footer.social_linkedin or footer.social_instagram %}
                
                {% if has_footer_content %}
                    <div class="row mb-3">
                        <div class="col-12">
                            <!-- Footer Text -->
                            {% if footer.text %}
                                <div class="text-center mb-2">
                                    <p class="text-muted mb-0 small">{{ footer.text }}</p>
                                </div>
                            {% endif %}
                            
                            <!-- Footer Links and Social Media -->
                            <div class="d-flex flex-column flex-md-row justify-content-center align-items-center gap-3">
                                <!-- Footer Links -->
                                {% if footer.link_1_text or footer.link_2_text or footer.link_3_text %}
                                    <div class="d-flex flex-wrap justify-content-center gap-3">
                                        {% if footer.link_1_text and footer.link_1_url %}
                                            <a href="{{ footer.link_1_url }}" class="text-muted text-decoration-none small">{{ footer.link_1_text }}</a>
                                        {% endif %}
                                        {% if footer.link_2_text and footer.link_2_url %}
                                            <a href="{{ footer.link_2_url }}" class="text-muted text-decoration-none small">{{ footer.link_2_text }}</a>
                                        {% endif %}
                                        {% if footer.link_3_text and footer.link_3_url %}
                                            <a href="{{ footer.link_3_url }}" class="text-muted text-decoration-none small">{{ footer.link_3_text }}</a>
                                        {% endif %}
                                    </div>
                                {% endif %}
                                
                                <!-- Social Media Links -->
                                {% if footer.social_facebook or footer.social_twitter or footer.social_linkedin or footer.social_instagram %}
                                    <div class="d-flex justify-content-center gap-2">
                                        {% if footer.social_facebook %}
                                            <a href="{{ footer.social_facebook }}" class="text-muted" target="_blank" title="Facebook">
                                                <i class="bi bi-facebook"></i>
                                            </a>
                                        {% endif %}
                                        {% if footer.social_twitter %}
                                            <a href="{{ footer.social_twitter }}" class="text-muted" target="_blank" title="Twitter/X">
                                                <i class="bi bi-twitter-x"></i>
                                            </a>
                                        {% endif %}
                                        {% if footer.social_linkedin %}
                                            <a href="{{ footer.social_linkedin }}" class="text-muted" target="_blank" title="LinkedIn">
                                                <i class="bi bi-linkedin"></i>
                                            </a>
                                        {% endif %}
                                        {% if footer.social_instagram %}
                                            <a href="{{ footer.social_instagram }}" class="text-muted" target="_blank" title="Instagram">
                                                <i class="bi bi-instagram"></i>
                                            </a>
                                        {% endif %}
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                {% endif %}
                
                <!-- Copyright and Version Row -->
                {% if footer.show_company_info or footer.show_version %}
                    <div class="row align-items-center">
                        {% if footer.show_company_info and footer.show_version %}
                            <!-- Both copyright and version -->
                            <div class="col-md-6 text-center text-md-start">
                                <span class="text-muted small">
                                    {% if footer.copyright_text %}
                                        {{ footer.copyright_text }}
                                    {% else %}
                                        &copy; {{ 'now'|date('Y') }} {{ company.name ?: 'BAYWORX EMS' }}
                                    {% endif %}
                                </span>
                            </div>
                            <div class="col-md-6 text-center text-md-end">
                                <span class="text-muted small">{{ config('app.version', 'v1.0.0') }}</span>
                            </div>
                        {% elseif footer.show_company_info %}
                            <!-- Only copyright -->
                            <div class="col-12 text-center">
                                <span class="text-muted small">
                                    {% if footer.copyright_text %}
                                        {{ footer.copyright_text }}
                                    {% else %}
                                        &copy; {{ 'now'|date('Y') }} {{ company.name ?: 'BAYWORX EMS' }}
                                    {% endif %}
                                </span>
                            </div>
                        {% elseif footer.show_version %}
                            <!-- Only version -->
                            <div class="col-12 text-center">
                                <span class="text-muted small">{{ config('app.version', 'v1.0.0') }}</span>
                            </div>
                        {% endif %}
                    </div>
                {% endif %}
            </div>
        </footer>

        <!-- Bootstrap JS -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
        
        <!-- Fix dropdown positioning -->
        <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Ensure all dropdowns are properly positioned
            const dropdowns = document.querySelectorAll('.dropdown-toggle');
            dropdowns.forEach(function(dropdown) {
                dropdown.addEventListener('show.bs.dropdown', function() {
                    const menu = this.nextElementSibling;
                    if (menu && menu.classList.contains('dropdown-menu')) {
                        // Force positioning update
                        setTimeout(function() {
                            menu.style.position = 'absolute';
                            menu.style.transform = 'none';
                        }, 10);
                    }
                });
            });
        });
        </script>
        
        {% block javascripts %}
        {% endblock %}
    </body>
</html>
