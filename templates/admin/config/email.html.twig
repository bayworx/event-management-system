{% extends 'admin/base.html.twig' %}

{% block title %}Email Settings - Configuration - {{ parent() }}{% endblock %}

{% block body %}
<div class="container-fluid py-4">
    <div class="row">
        <div class="col-12">
            <nav aria-label="breadcrumb" class="mb-4">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item">
                        <a href="{{ path('admin_dashboard') }}">Dashboard</a>
                    </li>
                    <li class="breadcrumb-item">
                        <a href="{{ path('admin_config_index') }}">Configuration</a>
                    </li>
                    <li class="breadcrumb-item active" aria-current="page">Email Settings</li>
                </ol>
            </nav>
        </div>
    </div>

    <div class="row">
        <div class="col-lg-8 col-xl-6">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-success text-white">
                    <div class="d-flex align-items-center">
                        <i class="bi bi-envelope me-2"></i>
                        <h5 class="card-title mb-0">Email Settings</h5>
                    </div>
                </div>
                <div class="card-body">
                    {{ form_start(form, {'attr': {'novalidate': 'novalidate'}}) }}
                    
                    <div class="mb-3">
                        {{ form_label(form.email_from_name) }}
                        {{ form_widget(form.email_from_name) }}
                        {{ form_errors(form.email_from_name) }}
                        {% if form.email_from_name.vars.help %}
                            <div class="form-text">{{ form.email_from_name.vars.help }}</div>
                        {% endif %}
                    </div>

                    <div class="mb-3">
                        {{ form_label(form.email_from_email) }}
                        {{ form_widget(form.email_from_email) }}
                        {{ form_errors(form.email_from_email) }}
                        {% if form.email_from_email.vars.help %}
                            <div class="form-text">{{ form.email_from_email.vars.help }}</div>
                        {% endif %}
                    </div>

                    <div class="mb-3">
                        {{ form_label(form.email_signature) }}
                        {{ form_widget(form.email_signature) }}
                        {{ form_errors(form.email_signature) }}
                        {% if form.email_signature.vars.help %}
                            <div class="form-text">{{ form.email_signature.vars.help }}</div>
                        {% endif %}
                    </div>

                    <div class="d-flex justify-content-between">
                        <a href="{{ path('admin_config_index') }}" class="btn btn-outline-secondary">
                            <i class="bi bi-arrow-left"></i> Back to Configuration
                        </a>
                        <button type="submit" class="btn btn-success">
                            <i class="bi bi-check-lg"></i> Save Email Settings
                        </button>
                    </div>

                    {{ form_end(form) }}
                </div>
            </div>
        </div>

        <div class="col-lg-4 col-xl-6">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-light">
                    <h6 class="card-title mb-0">
                        <i class="bi bi-info-circle"></i> About Email Settings
                    </h6>
                </div>
                <div class="card-body">
                    <h6>Sender Name</h6>
                    <p class="text-muted small mb-3">
                        The name that appears in the "From" field of all system emails. 
                        This is typically your company or organization name.
                    </p>

                    <h6>Sender Email Address</h6>
                    <p class="text-muted small mb-3">
                        The email address used as the sender for all system emails. This should 
                        be a valid email address from your domain. Common choices include:
                        <code>noreply@yourdomain.com</code> or <code>notifications@yourdomain.com</code>
                    </p>

                    <h6>Email Signature</h6>
                    <p class="text-muted small mb-3">
                        A default signature that will be appended to all system emails. 
                        You can use basic HTML tags for formatting. Keep it professional and concise.
                    </p>

                    <div class="alert alert-info small">
                        <i class="bi bi-lightbulb"></i>
                        <strong>Tip:</strong> Make sure your sender email address is configured 
                        in your mail server and has proper SPF/DKIM records to avoid emails 
                        being marked as spam.
                    </div>

                    <div class="alert alert-warning small">
                        <i class="bi bi-exclamation-triangle"></i>
                        <strong>Note:</strong> Changes to email settings will affect all future 
                        system emails including registration confirmations, password resets, 
                        and event notifications.
                    </div>
                </div>
            </div>

            <!-- Email Preview -->
            <div class="card border-0 shadow-sm mt-3">
                <div class="card-header bg-light">
                    <h6 class="card-title mb-0">
                        <i class="bi bi-eye"></i> Email Preview
                    </h6>
                </div>
                <div class="card-body">
                    <div class="border rounded p-3 bg-light">
                        <div class="small mb-2">
                            <strong>From:</strong> 
                            <span id="preview-from-name">{{ form.email_from_name.vars.data ?: 'Your Company Name' }}</span> 
                            &lt;<span id="preview-from-email">{{ form.email_from_email.vars.data ?: 'noreply@example.com' }}</span>&gt;
                        </div>
                        <div class="small mb-2">
                            <strong>Subject:</strong> Event Registration Confirmation
                        </div>
                        <hr>
                        <div class="small">
                            <p>Dear John Doe,</p>
                            <p>Thank you for registering for our upcoming event...</p>
                            <div class="mt-3 pt-2 border-top">
                                <div id="preview-signature">
                                    {{ form.email_signature.vars.data|raw ?: 'Best regards,<br>The Team' }}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script>
        // Live preview of email settings
        document.addEventListener('DOMContentLoaded', function() {
            const fromNameInput = document.querySelector('input[name="email_settings[email_from_name]"]');
            const fromEmailInput = document.querySelector('input[name="email_settings[email_from_email]"]');
            const signatureInput = document.querySelector('textarea[name="email_settings[email_signature]"]');
            
            const previewFromName = document.getElementById('preview-from-name');
            const previewFromEmail = document.getElementById('preview-from-email');
            const previewSignature = document.getElementById('preview-signature');
            
            if (fromNameInput && previewFromName) {
                fromNameInput.addEventListener('input', function() {
                    previewFromName.textContent = this.value || 'Your Company Name';
                });
            }
            
            if (fromEmailInput && previewFromEmail) {
                fromEmailInput.addEventListener('input', function() {
                    previewFromEmail.textContent = this.value || 'noreply@example.com';
                });
            }
            
            if (signatureInput && previewSignature) {
                signatureInput.addEventListener('input', function() {
                    previewSignature.innerHTML = this.value || 'Best regards,<br>The Team';
                });
            }
        });
    </script>
{% endblock %}